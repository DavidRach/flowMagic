<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Automated gating of flow cytometry data â€¢ flowMagic</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Automated gating of flow cytometry data">
<meta name="description" content="tool to perform the automated gating of bivariate flow cytometry data.">
<meta property="og:description" content="tool to perform the automated gating of bivariate flow cytometry data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">flowMagic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Documentation.html">Documentation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/semontante/flowMagic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="flowmagic">flowMagic<a class="anchor" aria-label="anchor" href="#flowmagic"></a>
</h1></div>
<p>Welcome to the flowMagic github repository!</p>
<p>flowMagic is an automated gating tool designed to automate the gating of bivariate flow cytometry (FCM) data. The flowMagic algorithm is the first algorithm trained on a large dataset of gated bivariate FCM data generated by the players of EVE Online, the online role-playing game developed by the CCP Games company.</p>
<p><img src="https://github.com/semontante/flowMagic/raw/main/intro/logo_flowmagic.png" alt="Project Logo"><img src="https://img.shields.io/github/license/semontante/flowMagic" alt="License"><img src="https://img.shields.io/github/issues/semontante/flowMagic" alt="Issues"><a href="https://github.com/semontante/flowMagic/blob/main/pk_manual/flowMagic_manual.pdf" class="external-link"><img src="https://img.shields.io/badge/flowMagic_doc-PDF-red" alt="PDF"></a></p>
</div>
<div class="section level1">
<h1 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h1>
<p>Flow cytometry (FCM) is a technology widely used in immunology and cell biology to enable the precise identification and quantification of heterogeneous cell populations across diverse applications. The prevailing analysis approach, termed gating, relies on expert manual analysis of hierarchical bivariate plots. This is a subjective and time-consuming approach that generate inconsistent results. In order to generate a large high quality training dataset in a relatively short amount of time, we recruited the players of EVE Online to gate milions of bivariate FCM plots within the mini-game Project Discovery. The flowMagic algorithm, trained on this large diverse dataset, represents a significant advancement in ML-based analysis of FCM data, combining citizen science and machine learning to develop more robust, generalizable automated FCM analysis tools.</p>
</div>
<div class="section level1">
<h1 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h1>
<p>The full technical documentation for the flowMagic R package can be found inside the <code>pk_manual</code> directory above. Click on the red pdf badge to download and visualize the flowMagic introduction (vignette).</p>
<p>The flowMagic framework can also be integrated with the popular flowCore and flowWorkspace R packages.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>The flowMagic package can be installed within R using the devtools library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"semontante/flowMagic"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the user can download the flowMagic package and install it from their local directory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"path/to/flowMagic.tar.gz"</span>,repos<span class="op">=</span><span class="cn">NULL</span>,type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="test-script">Test script<a class="anchor" aria-label="anchor" href="#test-script"></a>
</h1>
<p>The script below can be used to test the correct installation of the flowMagic package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joelgombin.github.io/concaveman/" class="external-link">concaveman</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pracma</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grDevices</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidrach.github.io/flowMagic/">flowMagic</a></span><span class="op">)</span></span>
<span><span class="co">#------------ using template model with 1 template</span></span>
<span><span class="co"># get path to directory with files to analyze</span></span>
<span><span class="va">path_dir</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package <span class="op">=</span> <span class="st">"flowMagic"</span><span class="op">)</span></span>
<span><span class="co"># import data with labels that we use as template data.</span></span>
<span><span class="va">list_data_ref</span><span class="op">&lt;-</span><span class="fu"><a href="reference/import_reference_csv.html">import_reference_csv</a></span><span class="op">(</span>path_results <span class="op">=</span> <span class="va">path_dir</span>,n_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># import data without labels</span></span>
<span><span class="va">list_test_data</span><span class="op">&lt;-</span><span class="fu"><a href="reference/import_test_set_csv.html">import_test_set_csv</a></span><span class="op">(</span>path_data <span class="op">=</span> <span class="va">path_dir</span>,n_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Note that it is possible to provide also directly the paths to each file. </span></span>
<span><span class="co"># See functions manual for additional details.</span></span>
<span><span class="co"># data preprocessing to generate the template model using first file as template</span></span>
<span><span class="co"># we select first element of the imported list of dataframes</span></span>
<span><span class="va">ref_train</span><span class="op">&lt;-</span><span class="fu"><a href="reference/get_train_data.html">get_train_data</a></span><span class="op">(</span>paths_file <span class="op">=</span> <span class="va">list_data_ref</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,n_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co"># generate template model using out-of-the-bag validation</span></span>
<span><span class="va">ref_model_info</span><span class="op">&lt;-</span><span class="fu"><a href="reference/magicTrain.html">magicTrain</a></span><span class="op">(</span>df_train <span class="op">=</span> <span class="va">ref_train</span>,n_cores <span class="op">=</span> <span class="fl">1</span>,train_model <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="co"># perform automated gating (gates boundaries prediction step)</span></span>
<span><span class="va">list_dfs_pred</span><span class="op">&lt;-</span><span class="fu"><a href="reference/magicPred_all.html">magicPred_all</a></span><span class="op">(</span>list_test_data <span class="op">=</span> <span class="va">list_test_data</span>,magic_model <span class="op">=</span> <span class="cn">NULL</span>,ref_data_train <span class="op">=</span> <span class="va">ref_train</span>,</span>
<span>ref_model_info <span class="op">=</span> <span class="va">ref_model_info</span>,n_cores <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co"># Note that providing the training set is optional (ref_data_train = ref_train is optional).</span></span>
<span><span class="co"># Providing the training set allows the user to calculate the target-template distance for each plot to analyze.</span></span>
<span><span class="co"># list_dfs_pred contains a list of dataframes for each plot analyzed. In other words, it is a nested list (e.g.,</span></span>
<span><span class="co"># downsampled dataset and original dataset with predicted labels for each plot). </span></span>
<span><span class="co"># See the functions manual for the full list of dataframes returned.</span></span>
<span><span class="co"># visualize gated data</span></span>
<span><span class="va">df_temp</span><span class="op">&lt;-</span><span class="va">list_dfs_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">$</span> <span class="va">df_test_original</span> <span class="co"># dataframe of first gated plot</span></span>
<span><span class="fu"><a href="reference/magicPlot.html">magicPlot</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_temp</span>,type <span class="op">=</span> <span class="st">"ML"</span>,size_points <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/magicPlot.html">magicPlot</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_temp</span>,type <span class="op">=</span> <span class="st">"dens"</span>,size_points <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h1>
<p>This R package is licensed under the Apache License 2.0. See the <code>LICENSE</code> and <code>NOTICE</code> files for more information.</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/semontante/flowMagic/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/semontante/flowMagic/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>Apache License 2.0 | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing flowMagic</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sebastiano Montante <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-6717-8706" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastiano Montante.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
